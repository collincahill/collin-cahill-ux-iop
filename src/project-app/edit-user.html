<!doctype html>
<link rel="import" href="/bower_components/polymer/polymer-element.html">

<dom-module id="edit-user">
  <template>
    <style>
			iron-form {
				display: flex;
				flex-direction: column;
				max-width: 30%;
			}
    </style>
		<iron-form action="http://httpbin.org/get">
			<template is="dom-repeat" items="{{fields}}">
				<new-user-input tag="{{item.tag}}"
												value="{{_getInputValue(user, item)}}"
												disabled="[[item.disabled]]">[[item.name]]</new-user-input>
			</template>
			<input type="submit" value="Save" />
		</iron-form>
  </template>

  <script>
    class EditUser extends Polymer.Element {
      static get is() { return 'edit-user'; }
			static get properties() {
				return {
					subroute: Object,
					id: {
						type: String,
						computed: "_getIdFromSubroute(subroute)"
					},
          userBase: Object,
					user: {
						type: Object,
						computed: "_getUserById(userBase, id)"
					},
					fields: Array,
				};
			}

			_getIdFromSubroute(subroute) {
				return subroute.path.substr(1);
			}

			_getUserById(userBase, id) {
        if (userBase === 'undefined') return {};
				try {
					for (var i = 0; i < userBase.length; i++) {
						if (userBase[i]['_id'] === id) return userBase[i];
					}
				} catch(e) {}
			}

			_getInputValue(user, item) {
				return typeof(user) === 'undefined' ? "" : user[item.tag];
			}
    }
		window.customElements.define(EditUser.is, EditUser);
  </script>
</dom-module>
